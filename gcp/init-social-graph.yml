---
- hosts: swarm_manager
  gather_facts: no
  become: no
  any_errors_fatal: true
  vars:
    - app: socialNetwork

  tasks:
    - name: Init social graph
      # task sleeps to make sure everything is initialized
      shell: >
            sleep 60 ;
            cd /code ;
            ./maestro.py {{ app }} --gcp wkld -f {{ configuration }} -E init-social-graph -r 1
      register: out
      failed_when: "not(out.rc == 0) or 'fail' in out.stderr"
